// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  password          String
  name              String?
  role              Role      @default(USER)
  isVerified        Boolean   @default(false)
  verificationToken String?   @unique
  resetToken        String?   @unique
  resetTokenExp     DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  phoneNumber       String?
  bookings          Booking[]
  reviews           Review[]
}

enum Role {
  USER
  ADMIN
}

model Car {
  id            String    @id @default(uuid())
  name          String
  slug          String    @unique
  brand         String
  type          String
  transmission  String
  fuelCapacity  Int
  pricePerDay   Float
  hp            Int       @default(0) // Default for existing records
  imageUrl      String?
  description   String?   @db.Text
  status        CarStatus @default(AVAILABLE)
  vehicleClass  String    @default("Standard")
  
  // New Metadata Fields
  pickupLocation   String[]  @default([])
  returnLocation   String[]  @default([])
  passengers       Int       @default(4)
  freeCancellation Boolean   @default(true) // Default 48h policy
  fuelType         String?   @default("Petrol")
  airConditioner   Boolean   @default(true)
  gps              Boolean   @default(true)
  gallery       String[]  @default([])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  bookings      Booking[]
}

enum CarStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
}

model Booking {
  id              String          @id @default(uuid())
  userId          String
  carId           String
  startDate       DateTime
  endDate         DateTime
  totalAmount     Float
  bondAmount      Float           @default(0)
  bondStatus      BondStatus      @default(PENDING)
  status          BookingStatus   @default(PENDING)
  paymentStatus   PaymentStatus   @default(PENDING)
  paymentMethod   PaymentMethod   @default(CASH)
  customerName    String?
  customerEmail   String?
  customerPhone   String?
  pickupLocation  String?
  returnLocation  String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  car             Car             @relation(fields: [carId], references: [id], onDelete: Cascade)
  payments        Payment[]

  @@index([userId])
  @@index([carId])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum BondStatus {
  PENDING
  PAID
  REFUNDED
  CLAIMED
}

enum PaymentMethod {
  CASH
  CARD
  ONLINE
}

model Payment {
  id                     String              @id @default(uuid())
  bookingId              String
  amount                 Float
  currency               String
  paymentMethod          PaymentMethod       @default(ONLINE)
  stripePaymentIntentId  String?
  stripeSessionId        String?
  status                 PaymentStatus       @default(PENDING)
  metadata               Json?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  booking                Booking             @relation(fields: [bookingId], references: [id], onDelete: Cascade)
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model SystemSettings {
  id                String   @id @default(uuid())
  siteName          String   @default("Lesssgo Car Rental")
  adminEmail        String   @default("sarmadusmani598@gmail.com")
  maintenanceMode   Boolean  @default(false)
  currency          String   @default("PGK")
  faviconUrl        String?
  passwordMinLength Int      @default(8)
  updatedAt         DateTime @updatedAt
}

model NewsletterSubscriber {
  id           String   @id @default(uuid())
  email        String   @unique
  subscribedAt DateTime @default(now())
}
